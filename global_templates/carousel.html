<div id="book-carousel" class="hidden lg:inline-block w-full max-w-full rounded-lg overflow-hidden shadow-lg relative">
    <div class="relative w-full h-64 md:h-96 overflow-hidden">
        {% for book in books %}
        <div id="ui_1" class="carousel-slide absolute inset-0 w-full h-full transition-all duration-700 transform opacity-0 bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-indigo-700 dark:to-purple-800 rounded-lg">
            <div class="flex flex-col lg:flex-row items-center h-full w-full overflow-hidden">
                <div class="w-full lg:w-1/2 p-4 flex justify-center">
                    <img src="{{ book.book_image.url }}" alt="{{ book.title }}" class=" object-cover rounded-lg shadow-lg transform transition-transform duration-300 hover:scale-105">
                </div>
                <div class="w-full lg:w-1/2 p-4 flex flex-col justify-center">
                    <h3 class="text-xl md:text-2xl font-bold text-white">{{ book.title }}</h3>
                    <h4 class="text-lg font-semibold text-white mt-1">Author: {{ book.author }}</h4>
                    <p class="mt-2 text-white opacity-90">Handpicked books for you.</p>
                    <p class="mt-2 text-white font-semibold">Total Borrowed Time: {{ book.total_borrowed_time }}</p>
                    <div class="mt-4">
                        <a href="{% url 'specific_book' book.id %}" class="btn glass text-white hover:bg-white/30 border-white">View Details</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Carousel Controls -->
    <button id="prevBtn" class="absolute left-3 top-1/2 -translate-y-1/2 bg-white/70 dark:bg-gray-800/70 hover:bg-white dark:hover:bg-gray-800 p-2 rounded-full shadow transition-all duration-300 transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-800 dark:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
    </button>
    <button id="nextBtn" class="absolute right-3 top-1/2 -translate-y-1/2 bg-white/70 dark:bg-gray-800/70 hover:bg-white dark:hover:bg-gray-800 p-2 rounded-full shadow transition-all duration-300 transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-800 dark:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
    </button>
    
    <!-- Indicators -->
    <div class="absolute bottom-4 left-0 right-0 flex justify-center space-x-2">
        {% for book in books %}
            <button class="carousel-indicator h-2 w-8 rounded-full bg-white/50 hover:bg-white/80 transition-all duration-300" data-index="{{ forloop.counter0 }}"></button>
        {% endfor %}
    </div>
</div>
<style>
    #ui_1 {
        margin: 0;
        height: 100%;
        width: 100%;
        max-width: 100%;
        overflow: hidden;

        background: linear-gradient(270deg, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8f00ff);
        background-size: 200% 200%; /* FIX: prevent stretching */
        animation: rainbow 100s ease infinite;
    }

    @keyframes rainbow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('book-carousel');
        if (!carousel) return;
        
        const slides = Array.from(carousel.querySelectorAll('.carousel-slide'));
        const indicators = Array.from(carousel.querySelectorAll('.carousel-indicator'));
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        
        if (slides.length === 0) return;

        let current = 0;
        let autoplay = true;
        const AUTOPLAY_DELAY = 2000;
        let timer = null;

        function goTo(index) {
            index = (index + slides.length) % slides.length;
            
            // Update slides
            slides.forEach((slide, i) => {
                if (i === index) {
                    slide.classList.remove('-translate-x-full', 'translate-x-full', 'opacity-0');
                    slide.classList.add('translate-x-0', 'opacity-100', 'z-10');
                } else if (i < index) {
                    slide.classList.remove('translate-x-0', 'translate-x-full', 'opacity-100', 'z-10');
                    slide.classList.add('-translate-x-full', 'opacity-0', 'z-0');
                } else {
                    slide.classList.remove('translate-x-0', '-translate-x-full', 'opacity-100', 'z-10');
                    slide.classList.add('translate-x-full', 'opacity-0', 'z-0');
                }
            });
            
            // Update indicators
            indicators.forEach((indicator, i) => {
                if (i === index) {
                    indicator.classList.add('bg-white', 'w-12');
                    indicator.classList.remove('bg-white/50', 'w-8');
                } else {
                    indicator.classList.remove('bg-white', 'w-12');
                    indicator.classList.add('bg-white/50', 'w-8');
                }
            });
            
            current = index;
        }

        function next() { goTo(current + 1); }
        function prev() { goTo(current - 1); }

        // Controls
        if (prevBtn) prevBtn.addEventListener('click', () => { prev(); resetTimer(); });
        if (nextBtn) nextBtn.addEventListener('click', () => { next(); resetTimer(); });
        
        // Indicator controls
        indicators.forEach((indicator, i) => {
            indicator.addEventListener('click', () => {
                goTo(i);
                resetTimer();
            });
        });

        // Autoplay
        function startTimer() {
            if (autoplay) timer = setInterval(next, AUTOPLAY_DELAY);
        }

        function stopTimer() {
            if (timer) { clearInterval(timer); timer = null; }
        }

        function resetTimer() {
            stopTimer();
            startTimer();
        }

        // Pause on hover
        carousel.addEventListener('mouseenter', stopTimer);
        carousel.addEventListener('mouseleave', startTimer);

        // Touch support
        let startX = 0, deltaX = 0;
        carousel.addEventListener('touchstart', (e) => {
            stopTimer();
            startX = e.touches[0].clientX;
            deltaX = 0;
        }, { passive: true });

        carousel.addEventListener('touchmove', (e) => {
            deltaX = e.touches[0].clientX - startX;
        }, { passive: true });

        carousel.addEventListener('touchend', () => {
            const threshold = 50;
            if (deltaX > threshold) prev();
            else if (deltaX < -threshold) next();
            resetTimer();
        });

        // Initialize
        goTo(0);
        startTimer();
        
        // Set first slide and indicator to active state
        if (slides.length > 0) {
            slides[0].classList.add('opacity-100', 'z-10');
        }
        if (indicators.length > 0) {
            indicators[0].classList.add('bg-white', 'w-12');
            indicators[0].classList.remove('bg-white/50');
        }
    });
</script>
