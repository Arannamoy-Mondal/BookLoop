{% extends 'base.html' %}
{% block title %}
BookLoop | Add Book
{% endblock %}

{% block content %}
<div class="flex justify-center items-center min-h-screen bg-gray-100 px-4 py-8">
  <div class="w-full max-w-lg bg-white p-8 rounded-2xl shadow-lg">
    <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Add a New Book</h2>

    {% if book %}
    <form action="" method="post" enctype="multipart/form-data" class="space-y-5">
      {% csrf_token %}


      <div>
        <label for="title" class="block text-black font-semibold mb-2">Title</label>
        <input type="text" name="title" id="title" required value="{{book.title}}"
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>


      <div>
        <label for="description" class="block text-black font-semibold mb-2">Description</label>
        <textarea name="description" id="description" rows="3" required 
                  class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:outline-none">{{book.description}}</textarea>
      </div>


      <div>
        <label for="author" class="block text-black font-semibold mb-2">Author</label>
        <input type="text" name="author" id="author"  required value="{{book.author}}"
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>


      <div>
        <label for="borrow_price" class="block text-black font-semibold mb-2">Borrow Price</label>
        <input type="number" name="borrow_price" id="borrow_price" required value="{{book.borrow_price}}"
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>


      <div>
        <label for="book_image" class="block text-black font-semibold mb-2">Book Image</label>
        <input type="file" name="book_image" id="book_image" required value="{{book.book_image}}"
               class="w-full bg-white
                text-black border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 
                      file:rounded-lg file:border-0 file:text-sm file:font-semibold 
                      file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
      </div>

      <!-- Quantity -->
      <div>
        <label for="quantity" class="block text-black font-semibold mb-2">Quantity</label>
        <input type="number" name="quantity"  value="120" required
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>

      <!-- Submit -->
      <div class="flex justify-center">
        <button type="submit"
                class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md 
                       hover:bg-blue-700 focus:ring-2 focus:ring-blue-400 focus:outline-none transition duration-200">
          Update Book
        </button>
      </div>
    </form>
    {% else %}
    <form action="" method="post" enctype="multipart/form-data" class="space-y-5">
      {% csrf_token %}


      <div>
        <label for="title" class="block text-black font-semibold mb-2">Title</label>
        <input type="text" name="title" id="title" required value="The 7 Habits of Highly Effective People: Powerful Lessons in Personal Change"
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>


      <div>
        <label for="description" class="block text-black font-semibold mb-2">Description</label>
        <textarea name="description" id="description" rows="3" required 
                  class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:outline-none">
                In The 7 Habits of Highly Effective People, author Stephen R. Covey presents a holistic, integrated, principle-centered approach for solving personal and professional problems. With penetrating insights and pointed anecdotes, Covey reveals a step-by-step pathway for living with fairness, integrity, service, and human dignity--principles that give us the security to adapt to change and the wisdom and power to take advantage of the opportunities that change creates.
                </textarea>
      </div>


      <div>
        <label for="author" class="block text-black font-semibold mb-2">Author</label>
        <input type="text" name="author" id="author"  required value=" Stephen R. Covey"
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>


      <div>
        <label for="borrow_price" class="block text-black font-semibold mb-2">Borrow Price</label>
        <input type="number" name="borrow_price" id="borrow_price" required value="120"
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>


      <div>
        <label for="book_image" class="block text-black font-semibold mb-2">Book Image</label>
        <input type="file" name="book_image" id="book_image" required
               class="w-full bg-white
                text-black border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 
                      file:rounded-lg file:border-0 file:text-sm file:font-semibold 
                      file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
      </div>

 
      <div class="relative">
        <label class="block text-black font-semibold mb-2">Categories</label>


        <button type="button" id="dropdownButton" 
                class="w-full flex justify-between items-center px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:outline-none">
          <span id="selectedCategories" class="text-gray-600">Select Categories</span>
          <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>


        <div id="dropdownMenu" class="hidden absolute z-10 w-full mt-2 bg-white text-black border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto">
          <div class="p-3 space-y-2">
            {% for category in categories %}
            <label class="flex items-center space-x-2">
              <input type="checkbox" name="category" value={{category.title}} class=" w-4 h-4 bg-white text-black bg-white text-black border-gray-300 rounded">
              <span>{{category.title}}</span>
            </label>
            {% endfor %}
            
          </div>
        </div>
      </div>

      <!-- Quantity -->
      <div>
        <label for="quantity" class="block text-black font-semibold mb-2">Quantity</label>
        <input type="number" name="quantity"  value="120" required
               class="w-full px-4 py-2 bg-white text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
      </div>

      <!-- Submit -->
      <div class="flex justify-center">
        <button type="submit"
                class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md 
                       hover:bg-blue-700 focus:ring-2 focus:ring-blue-400 focus:outline-none transition duration-200">
          Add Book
        </button>
      </div>
    </form>
    {% endif %}
  </div>
</div>

<script>
  const dropdownBtn = document.getElementById('dropdownButton');
  const dropdownMenu = document.getElementById('dropdownMenu');
  const selectedCategories = document.getElementById('selectedCategories');

  dropdownBtn.addEventListener('click', () => {
    dropdownMenu.classList.toggle('hidden');
  });

  // Update selected categories text
  dropdownMenu.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
    checkbox.addEventListener('change', () => {
      const selected = Array.from(dropdownMenu.querySelectorAll('input[type="checkbox"]:checked'))
        .map(cb => cb.nextElementSibling.textContent);
      selectedCategories.textContent = selected.length > 0
        ? selected.join(', ')
        : 'Select Categories';
    });
  });

  // Close dropdown if clicked outside
  window.addEventListener('click', (e) => {
    if (!dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
      dropdownMenu.classList.add('hidden');
    }
  });
</script>
{% endblock %}
